### HOI4 Mod Builder v0.2.9.1 (HotFix)

### Список изменений и исправлений:
> - Добавил поддержку модификатора "affects_energy" в постройках (HOI4 v1.17.2)
> - Отключил проверку на множественное объявление Категорий областей в одном файле
> - Отключил использование настроек мода по умолчанию в Настройках программы
> - Временно отключил WIP настройку "MapPositions" в Настройках программы

---

### HOI4 Mod Builder v0.2.9

### Список изменений:

- Совместимость с Hearts of Iron 4 v1.17.*:
> - Добавлена поддержка загрузки и отображения стратегических локаций на карте
> - Добавлена поддержка новых параметров построек
> - Добавлена поддержка новых параметров категорий областей

- Интерфейс и карта:
> - Добавлена иконка приложения
> - Существенно переработано контекстное меню карты
> - В контекстное меню добавлен пункт, позволяющий объединять все выделенные провинции в одну единственную провинцию
> - Добавлена автоматическая фокусировка камеры на центре группы выделенных объектов при поиске через контекстное меню
> - Кнопка «Обновить всё» теперь также обновляет рендер основного слоя карты и текст на нём
> - Добавлен учёт позиции курсора при зуме карты
> - Добавлено отображение дополнительных иконок курсора в зависимости от текущего действия и контекста
> - Улучшена заметность указателя на фоне карты — теперь он одинаково хорошо различим на светлом и тёмном фоне
> - Добавлены горячие клавиши для быстрого выбора отображаемого основного слоя карты
> - Улучшено отображение выделения смежностей (морских переходов) на карте
> - Улучшено отображение национальных областей и претензий стран на области
> - Добавлена автоматическая сортировка игровых закладок по дате
> - Доработан алгоритм отрисовки слоя построек: теперь провинции и области окрашиваются в тёмно-красный цвет, если выбранная постройка не может быть размещена из-за несоответствия прибрежности, и в ярко-красный — если она уже размещена с ошибкой

- Окно настроек:
> - Добавлена кнопка «Автопоиск путей» для быстрого поиска и выбора игровых директорий
> - Добавлена WIP-настройка «Map Positions» для загрузки и поиска некорректных или отсутствующих данных о позициях 3D-моделей построек (помогает выявлять области, требующие валидации в Nudge)
> - Добавлена настройка минимально и максимально допустимого смещения высоты для земли и воды, при превышении которого программа перестаёт игнорировать несоответствие пикселя карты высот и типа провинции и отображает предупреждение HEIGHTMAP_MISMATCH
> - Добавлена настройка шаблонов генерации HSV-цветов для наземных, морских и озёрных провинций, областей и регионов, а также для провинций от областей

- Генерация цвета и палитра:
> - Добавлен элемент выбора цвета (ColorPicker), вызываемый нажатием на пункт «Цвета:» в верхней панели
> - Добавлена история последних 10 выбранных цветов (отображается в палитре цветов)
> - Переработан алгоритм генерации цветов для наземных, морских и озёрных провинций — теперь используется HSV-генератор с параметрами из окна настроек программы
> - Добавлен новый алгоритм генерации HSV-цветов для областей и регионов при загрузке с целью уменьшения схожести цветов соседних областей и регионов на карте
> - Добавлен инструмент перегенерации цветов провинций в двух режимах: случайные цвета на основе ID провинций и цвета провинций на основе цветов областей. Инструмент доступен через «Правка → Инструменты авторасчёта → Перегенерировать цвета провинций»

- Окно статистики:
> - Добавлено окно статистики, открываемое через «Данные → Статистика»
> - Поддерживается фильтрация по ID областей и стратегических регионов, а также по тегам стран
> - Отображаются данные по провинциям и их границам, континентам, ландшафтам, железным дорогам, узлам снабжения, смежностям, постройкам, ресурсам, населению, областям и их категориям, стратегическим регионам
> - Для ряда параметров отображаются максимальные ограничения движка (например, не более 65536 границ провинций)

- Предупреждения и ошибки на карте:
> - В настройки добавлены параметры допустимого несоответствия пикселя на карте высот и типа провинции
> - Добавлен поиск ошибок, связанных с разделением на несвязанные части областей и стратегических регионов на карте (в некоторых случаях это вызывает краши игры)
> - Отключён поиск ошибок RIVER_CROSSING (перекрывается другими проверками)
> - Добавлено предупреждение при превышении лимита в 65536 границ провинций
> - Добавлен поиск ошибки STATE_WITH_NO_OWNER (область без владельца вызывает краш)
> - Добавлен поиск ошибки COASTAL_BUILDING_IN_NOT_COASTAL_LAND_PROVINCE
> - Отключён поиск предупреждений PROVINCE_WRONG_COLOR
> - Добавлены предупреждения о том, что ширина или высота карты провинций не делится без остатка на 256 или в ней слишком много пикселей (ограничения движка игры, вызывает краш)
> - Добавлены предупреждения о постройках в морских и озёрных провинциях с их автоудалением из областей при загрузке
> - Добавлены предупреждения о ЖД и узлах снабжения в морских и озёрных провинциях с их автоудалением при загрузке
> - Добавлено предупреждение о железных дорогах длиной менее двух провинций с их автоудалением при загрузке

- Инструменты:
> - Добавлена автосортировка тегов стран
> - Добавлен автоматический перерасчёт центров областей и регионов при изменении состава провинций
> - Добавлена возможность прокладывать железные дороги между любыми, а не только соседними наземными провинциями (используется алгоритм A* для поиска пути)
> - Инструмент поиска изменений на карте перенесён из инструментов авторасчёта в расширенные инструменты
> - Добавлен инструмент редактирования ресурсов и режим карты для их отображения на основном слое
> - Добавлена поддержка кастомных кистей в "data/custom/brushes"
> - Улучшена работа инструмента MapToolEraser
> - Для MapToolBrush и MapToolFill добавлена автопроверка HEIGHTMAP_MISMATCH для изменяемых пикселей на карте
> - Добавлена поддержка MapToolFill для карты высот
> - Добавлено предупреждение при заливке более 500 000 пикселей за один клик с возможностью отмены действия
> - В MapToolBuildings добавлен запрет на размещение построек в провинциях и областях при несоответствии их прибрежности
> - Добавлено обновление текста на основном слое при объединении провинций
> - Добавлен инструмент редактирования стратегических локаций и режим карты для их отображения на основном слое

- Данные:
> - Включена автовалидация областей и стратегических регионов при загрузке (не путать с автовалидацией в Nudge)
> - Добавлено быстрое создание новых областей и регионов по шаблону (либо через контекстное меню, либо через "Данные" -> "Создать объект и скрипт")
> - Добавлено автоудаление некорректных очков победы
> - Добавлена поддержка новых модификаторов: "state_resource_cost_<resource>", "naval_headquarter", "local_factory_energy_consumption"

- Оптимизация:
> - Существенно ускорен запуск приложения
> - Загрузка и сохранение данных ускорены в 2–3 раза
> - Значительно оптимизирован инструмент MergeProvincesTool

- Техническая часть:
> - DLL-библиотеки вынесены из EXE в отдельную папку dll
> - Улучшен парсер игровых файлов
> - Поиск папки игры в «Документах» теперь ориентируется на папку "mod", а не "save games"
> - Добавлено корректное сообщение об ошибке при невозможности проверить наличие обновлений программы из-за проблем с интернет-соединением

- Локализация:
> - Многочисленные исправления и уточнения переводов

---

### Список исправлений:

> - Исправлена некорректная отрисовка текста из-за низкой точности float в шейдере
> - Устранена утечка видеопамяти при перезагрузке текста
> - Исправлено мигание карты при обновлении текста
> - Исправлена ошибка сбора результатов поиска ошибок и предупреждений
> - Исправлена ошибка загрузки настроек при отсутствии директории мода
> - Исправлены ошибки активации и деактивации пунктов в списке фильтров в окне настроек поиска ошибок и предупреждений
> - Частично исправлен экспорт основного слоя карты
> - Исправлено некорректное удаление построек из областей, если их новое количество стало равно 0
> - Исправлена работа MapToolVictoryPoints
> - Исправлено отсутствие перерисовки основного слоя карты при объединении провинций, если был выбран любой другой слой кроме карты провинций
> - Исправлена возможность перемещения пустой карты
> - Исправлен алгоритм вычисления значений цветов пикселей основного слоя карты по логарифмической шкале
> - Исправлена возможность выделения скрытых ЖД и узлов снабжения
> - Исправлено некорректное обновление параметров инструментов при вращении колеса мыши с зажатым SHIFT
> - Исправлена ошибка загрузки игровой закладки при отсутствии блока History внутри какой-либо области
> - Исправлена ошибка первого запуска
> - Исправлены ошибки объединения провинций
> - Исправлены многочисленные ошибки в окне настроек программы
> - Исправлено некорректное очищение старых результатов поиска предупреждений и ошибок после отключения соответствующих фильтров в окне настроек поиска ошибок и предупреждений
> - Исправлены возможные ошибки в окне провинций
> - Исправлены ошибки расчёта границ областей и регионов
> - Исправлена ошибка, приводившая к отображению информационных окон под основным окном программы
> - Исправлена валидация очков победы при загрузке
> - Исправлено форматирование списков при сохранении игровых файлов
> - Исправлена ошибка, возникавшая при нажатии на карту после неудачной загрузки данных мода
> - Исправлено отображение списка ошибок после перезагрузки данных мода
> - Исправлено некорректное сохранение констант в игровых файлах
